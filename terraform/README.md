# Terraform Infrastructure for Flarum Community

ì´ ë””ë ‰í† ë¦¬ëŠ” OCI Always Free Tierì— Flarum ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ Terraform ì¸í”„ë¼ ì½”ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        OCI Always Free Tier                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Public Subnet â”‚    â”‚      Private Subnet            â”‚  â”‚
â”‚  â”‚                 â”‚    â”‚                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Flarum Web  â”‚â”‚    â”‚  â”‚    MySQL Database       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   Server    â”‚â”‚â—„â”€â”€â”€â”¤  â”‚      Server              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ (2 OCPU)    â”‚â”‚    â”‚  â”‚    (1 OCPU)             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ 12GB RAM    â”‚â”‚    â”‚  â”‚    6GB RAM               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ íŒŒì¼ êµ¬ì¡°

- `main.tf` - ë©”ì¸ ì¸í”„ë¼ ë¦¬ì†ŒìŠ¤ ì •ì˜
- `variables.tf` - ì…ë ¥ ë³€ìˆ˜ ì •ì˜
- `outputs.tf` - ì¶œë ¥ ê°’ ì •ì˜
- `terraform.tfvars.example` - ë³€ìˆ˜ ê°’ ì˜ˆì‹œ íŒŒì¼
- `user_data.sh` - Flarum ì›¹ì„œë²„ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
- `mysql_user_data.sh` - MySQL ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. ì‚¬ì „ ì¤€ë¹„

1. **OCI ê³„ì • ì„¤ì •**

   - OCI ê³„ì • ìƒì„± ë° ë¡œê·¸ì¸
   - API í‚¤ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
   - Compartment ìƒì„±

2. **SSH í‚¤ ìƒì„±**
   ```bash
   ssh-keygen -t rsa -b 4096 -C "your-email@example.com"
   ```

### 2. ë³€ìˆ˜ ì„¤ì •

```bash
# terraform.tfvars.exampleì„ ë³µì‚¬í•˜ì—¬ ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •
cp terraform.tfvars.example terraform.tfvars

# terraform.tfvars íŒŒì¼ì„ í¸ì§‘í•˜ì—¬ ì‹¤ì œ ê°’ ì…ë ¥
vim terraform.tfvars
```

### 3. Terraform ì‹¤í–‰

```bash
# Terraform ì´ˆê¸°í™”
terraform init

# ì‹¤í–‰ ê³„íš í™•ì¸
terraform plan

# ì¸í”„ë¼ ë°°í¬
terraform apply

# ë°°í¬ í™•ì¸
terraform output
```

### 4. ì ‘ì† ë° ì„¤ì •

1. **Flarum ì ‘ì†**

   ```bash
   # ì¶œë ¥ëœ URLë¡œ ì ‘ì†
   http://<flarum_public_ip>
   ```

2. **SSH ì ‘ì†**
   ```bash
   ssh opc@<flarum_public_ip>
   ```

## ğŸ”§ ì£¼ìš” ë¦¬ì†ŒìŠ¤

### Compute Instances

- **Flarum Web Server**: VM.Standard.A1.Flex (2 OCPU, 12GB RAM)
- **MySQL Database**: VM.Standard.A1.Flex (1 OCPU, 6GB RAM)

### Network

- **VCN**: 10.0.0.0/16
- **Public Subnet**: 10.0.1.0/24 (Flarum ì›¹ì„œë²„)
- **Private Subnet**: 10.0.2.0/24 (MySQL ë°ì´í„°ë² ì´ìŠ¤)

### Security

- **Security Lists**: HTTP(80), HTTPS(443), SSH(22), MySQL(3306)
- **Route Tables**: ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ì—°ê²°

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ë„¤íŠ¸ì›Œí¬ ë¶„ë¦¬**: ì›¹ì„œë²„ëŠ” ê³µìš© ì„œë¸Œë„·, ë°ì´í„°ë² ì´ìŠ¤ëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„·
2. **ë°©í™”ë²½**: í•„ìš”í•œ í¬íŠ¸ë§Œ ê°œë°©
3. **SSL/TLS**: Let's Encrypt ì¸ì¦ì„œ ìë™ ì„¤ì •
4. **ë°ì´í„°ë² ì´ìŠ¤ ë³´ì•ˆ**: í”„ë¼ì´ë¹— ë„¤íŠ¸ì›Œí¬ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥

## ğŸ“Š ë¹„ìš©

- **Always Free Tier** ì‚¬ìš©ìœ¼ë¡œ **ë¬´ë£Œ**
- VM.Standard.A1.Flex ì¸ìŠ¤í„´ìŠ¤ 2ê°œ (ì´ 3 OCPU, 18GB RAM)
- VCN, ì„œë¸Œë„·, ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ë“± ë„¤íŠ¸ì›Œí¬ ë¦¬ì†ŒìŠ¤

## ğŸ› ï¸ ê´€ë¦¬ ëª…ë ¹ì–´

```bash
# ì¸í”„ë¼ ìƒíƒœ í™•ì¸
terraform show

# íŠ¹ì • ë¦¬ì†ŒìŠ¤ë§Œ ì¬ìƒì„±
terraform apply -replace=oci_core_instance.flarum_instance

# ì¸í”„ë¼ ì‚­ì œ
terraform destroy

# ì¶œë ¥ ê°’ í™•ì¸
terraform output flarum_url
```

## ğŸ” ë¬¸ì œ í•´ê²°

1. **ì¸ìŠ¤í„´ìŠ¤ ì ‘ì† ë¶ˆê°€**

   - SSH í‚¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
   - ë³´ì•ˆ ê·¸ë£¹ì—ì„œ SSH í¬íŠ¸(22) í—ˆìš© í™•ì¸

2. **Flarum ì ‘ì† ë¶ˆê°€**

   - ì›¹ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ì—ˆëŠ”ì§€ í™•ì¸
   - ë°©í™”ë²½ ì„¤ì • í™•ì¸

3. **ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜**
   - MySQL ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
   - ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸

## ğŸ“ ì¶”ê°€ ì„¤ì •

### SSL ì¸ì¦ì„œ ì„¤ì •

```bash
# ë„ë©”ì¸ ì„¤ì • í›„ SSL ì¸ì¦ì„œ ë°œê¸‰
ssh opc@<flarum_public_ip>
sudo /home/opc/setup-ssl.sh
```

### Flarum í™•ì¥ í”„ë¡œê·¸ë¨ ì„¤ì¹˜

```bash
# SSHë¡œ ì ‘ì† í›„
cd /home/opc/flarum
docker-compose exec flarum extension:install <extension-name>
```
